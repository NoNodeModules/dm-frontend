{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _defineProperty from \"/home/ajay/web/projects/dm-frontend/node_modules/@babel/runtime/helpers/esm/defineProperty\";\n\nvar _jsxFileName = \"/home/ajay/web/projects/dm-frontend/src/contexts/useAuth.js\",\n    _this = this,\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport Cookies from \"js-cookie\";\nimport Router from \"next/router\";\nimport { createContext, useContext, useEffect, useReducer } from \"react\";\nimport publicPages from \"components/auth/public-pages\";\nimport axios from \"axios\";\nexport var AuthContext = /*#__PURE__*/createContext();\nvar RESET_USER_STATE = \"RESET_USER_STATE\";\nvar initialState = {\n  isLoading: true,\n  isAuthenticated: false,\n  pic: null,\n  fullname: null\n};\n\nvar userReducer = function userReducer(state, action) {\n  switch (action.type) {\n    case RESET_USER_STATE:\n      var appCookies = action.payload;\n      return _objectSpread(_objectSpread({}, state), {}, {\n        isAuthenticated: appCookies.authenticated,\n        pic: appCookies.pic,\n        fullname: appCookies.fullname && appCookies.fullname.split(\"_\").join(\" \"),\n        isLoading: false\n      });\n\n    default:\n      return state;\n  }\n};\n\nexport var AuthProvider = function AuthProvider(props) {\n  _s();\n\n  var _useReducer = useReducer(userReducer, initialState),\n      state = _useReducer[0],\n      dispatch = _useReducer[1];\n\n  useEffect(function () {\n    refreshAuthContext();\n  }, []);\n  useEffect(function () {\n    if (!state.isLoading) {\n      var path = props.appProps.router.route;\n\n      if (path != \"/\" && !state.isAuthenticated && !publicPages.includes(path)) {\n        Router.push(\"/\");\n      }\n    }\n  }, [state.isAuthenticated, state.isLoading]);\n\n  var refreshAuthContext = function refreshAuthContext() {\n    dispatch({\n      type: RESET_USER_STATE,\n      payload: Cookies.get()\n    });\n  };\n\n  var logout = function logout() {\n    axios({\n      url: process.env.NEXT_PUBLIC_MIDDLEWARE_URL + \"/session/logout\",\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      withCredentials: true\n    }).then(function (res) {\n      refreshAuthContext();\n    });\n  };\n\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      refreshAuthContext: refreshAuthContext,\n      logout: logout,\n      isLoading: state.isLoading,\n      isAuthenticated: state.isAuthenticated,\n      pic: state.pic,\n      fullname: state.fullname\n    },\n    children: props.children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 72,\n    columnNumber: 5\n  }, _this);\n};\n\n_s(AuthProvider, \"GUSXxL/WUElrtHc/X73NyHNRMdw=\");\n\n_c = AuthProvider;\nexport var useAuth = function useAuth() {\n  _s2();\n\n  return useContext(AuthContext);\n};\n\n_s2(useAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\n\nvar _c;\n\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"sources":["/home/ajay/web/projects/dm-frontend/src/contexts/useAuth.js"],"names":["Cookies","Router","createContext","useContext","useEffect","useReducer","publicPages","axios","AuthContext","RESET_USER_STATE","initialState","isLoading","isAuthenticated","pic","fullname","userReducer","state","action","type","appCookies","payload","authenticated","split","join","AuthProvider","props","dispatch","refreshAuthContext","path","appProps","router","route","includes","push","get","logout","url","process","env","NEXT_PUBLIC_MIDDLEWARE_URL","method","headers","withCredentials","then","res","children","useAuth"],"mappings":";;;;;;;;;;;;AAAA,OAAOA,OAAP,MAAoB,WAApB;AACA,OAAOC,MAAP,MAAmB,aAAnB;AACA,SAASC,aAAT,EAAwBC,UAAxB,EAAoCC,SAApC,EAA+CC,UAA/C,QAAiE,OAAjE;AACA,OAAOC,WAAP,MAAwB,8BAAxB;AACA,OAAOC,KAAP,MAAkB,OAAlB;AAEA,OAAO,IAAMC,WAAW,gBAAGN,aAAa,EAAjC;AACP,IAAMO,gBAAgB,GAAG,kBAAzB;AAEA,IAAMC,YAAY,GAAG;AACnBC,EAAAA,SAAS,EAAE,IADQ;AAEnBC,EAAAA,eAAe,EAAE,KAFE;AAGnBC,EAAAA,GAAG,EAAE,IAHc;AAInBC,EAAAA,QAAQ,EAAE;AAJS,CAArB;;AAOA,IAAMC,WAAW,GAAG,SAAdA,WAAc,CAACC,KAAD,EAAQC,MAAR,EAAmB;AACrC,UAAQA,MAAM,CAACC,IAAf;AACE,SAAKT,gBAAL;AACE,UAAMU,UAAU,GAAGF,MAAM,CAACG,OAA1B;AACA,6CACKJ,KADL;AAEEJ,QAAAA,eAAe,EAAEO,UAAU,CAACE,aAF9B;AAGER,QAAAA,GAAG,EAAEM,UAAU,CAACN,GAHlB;AAIEC,QAAAA,QAAQ,EACNK,UAAU,CAACL,QAAX,IAAuBK,UAAU,CAACL,QAAX,CAAoBQ,KAApB,CAA0B,GAA1B,EAA+BC,IAA/B,CAAoC,GAApC,CAL3B;AAMEZ,QAAAA,SAAS,EAAE;AANb;;AAQF;AACE,aAAOK,KAAP;AAZJ;AAcD,CAfD;;AAiBA,OAAO,IAAMQ,YAAY,GAAG,SAAfA,YAAe,CAACC,KAAD,EAAW;AAAA;;AAAA,oBACXpB,UAAU,CAACU,WAAD,EAAcL,YAAd,CADC;AAAA,MAC9BM,KAD8B;AAAA,MACvBU,QADuB;;AAGrCtB,EAAAA,SAAS,CAAC,YAAM;AACduB,IAAAA,kBAAkB;AACnB,GAFQ,EAEN,EAFM,CAAT;AAIAvB,EAAAA,SAAS,CAAC,YAAM;AACd,QAAI,CAACY,KAAK,CAACL,SAAX,EAAsB;AACpB,UAAMiB,IAAI,GAAGH,KAAK,CAACI,QAAN,CAAeC,MAAf,CAAsBC,KAAnC;;AACA,UACEH,IAAI,IAAI,GAAR,IACA,CAACZ,KAAK,CAACJ,eADP,IAEA,CAACN,WAAW,CAAC0B,QAAZ,CAAqBJ,IAArB,CAHH,EAIE;AACA3B,QAAAA,MAAM,CAACgC,IAAP,CAAY,GAAZ;AACD;AACF;AACF,GAXQ,EAWN,CAACjB,KAAK,CAACJ,eAAP,EAAwBI,KAAK,CAACL,SAA9B,CAXM,CAAT;;AAaA,MAAMgB,kBAAkB,GAAG,SAArBA,kBAAqB,GAAM;AAC/BD,IAAAA,QAAQ,CAAC;AAAER,MAAAA,IAAI,EAAET,gBAAR;AAA0BW,MAAAA,OAAO,EAAEpB,OAAO,CAACkC,GAAR;AAAnC,KAAD,CAAR;AACD,GAFD;;AAIA,MAAMC,MAAM,GAAG,SAATA,MAAS,GAAM;AACnB5B,IAAAA,KAAK,CAAC;AACJ6B,MAAAA,GAAG,EAAEC,OAAO,CAACC,GAAR,CAAYC,0BAAZ,GAAyC,iBAD1C;AAEJC,MAAAA,MAAM,EAAE,MAFJ;AAGJC,MAAAA,OAAO,EAAE;AACP,wBAAgB;AADT,OAHL;AAMJC,MAAAA,eAAe,EAAE;AANb,KAAD,CAAL,CAOGC,IAPH,CAOQ,UAACC,GAAD,EAAS;AACfjB,MAAAA,kBAAkB;AACnB,KATD;AAUD,GAXD;;AAaA,sBACE,QAAC,WAAD,CAAa,QAAb;AACE,IAAA,KAAK,EAAE;AACLA,MAAAA,kBAAkB,EAAlBA,kBADK;AAELQ,MAAAA,MAAM,EAANA,MAFK;AAGLxB,MAAAA,SAAS,EAAEK,KAAK,CAACL,SAHZ;AAILC,MAAAA,eAAe,EAAEI,KAAK,CAACJ,eAJlB;AAKLC,MAAAA,GAAG,EAAEG,KAAK,CAACH,GALN;AAMLC,MAAAA,QAAQ,EAAEE,KAAK,CAACF;AANX,KADT;AAAA,cAUGW,KAAK,CAACoB;AAVT;AAAA;AAAA;AAAA;AAAA,WADF;AAcD,CAnDM;;GAAMrB,Y;;KAAAA,Y;AAqDb,OAAO,IAAMsB,OAAO,GAAG,SAAVA,OAAU,GAAM;AAAA;;AAC3B,SAAO3C,UAAU,CAACK,WAAD,CAAjB;AACD,CAFM;;IAAMsC,O","sourcesContent":["import Cookies from \"js-cookie\";\nimport Router from \"next/router\";\nimport { createContext, useContext, useEffect, useReducer } from \"react\";\nimport publicPages from \"components/auth/public-pages\";\nimport axios from \"axios\";\n\nexport const AuthContext = createContext();\nconst RESET_USER_STATE = \"RESET_USER_STATE\";\n\nconst initialState = {\n  isLoading: true,\n  isAuthenticated: false,\n  pic: null,\n  fullname: null,\n};\n\nconst userReducer = (state, action) => {\n  switch (action.type) {\n    case RESET_USER_STATE:\n      const appCookies = action.payload;\n      return {\n        ...state,\n        isAuthenticated: appCookies.authenticated,\n        pic: appCookies.pic,\n        fullname:\n          appCookies.fullname && appCookies.fullname.split(\"_\").join(\" \"),\n        isLoading: false,\n      };\n    default:\n      return state;\n  }\n};\n\nexport const AuthProvider = (props) => {\n  const [state, dispatch] = useReducer(userReducer, initialState);\n\n  useEffect(() => {\n    refreshAuthContext();\n  }, []);\n\n  useEffect(() => {\n    if (!state.isLoading) {\n      const path = props.appProps.router.route;\n      if (\n        path != \"/\" &&\n        !state.isAuthenticated &&\n        !publicPages.includes(path)\n      ) {\n        Router.push(\"/\");\n      }\n    }\n  }, [state.isAuthenticated, state.isLoading]);\n\n  const refreshAuthContext = () => {\n    dispatch({ type: RESET_USER_STATE, payload: Cookies.get() });\n  };\n\n  const logout = () => {\n    axios({\n      url: process.env.NEXT_PUBLIC_MIDDLEWARE_URL + \"/session/logout\",\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      withCredentials: true,\n    }).then((res) => {\n      refreshAuthContext();\n    });\n  };\n\n  return (\n    <AuthContext.Provider\n      value={{\n        refreshAuthContext,\n        logout,\n        isLoading: state.isLoading,\n        isAuthenticated: state.isAuthenticated,\n        pic: state.pic,\n        fullname: state.fullname,\n      }}\n    >\n      {props.children}\n    </AuthContext.Provider>\n  );\n};\n\nexport const useAuth = () => {\n  return useContext(AuthContext);\n};\n"]},"metadata":{},"sourceType":"module"}